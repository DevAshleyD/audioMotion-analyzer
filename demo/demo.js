!function(t){var e={};function i(s){if(e[s])return e[s].exports;var a=e[s]={i:s,l:!1,exports:{}};return t[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(s,a,function(e){return t[e]}.bind(null,a));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));
/**
 * audioMotion-analyzer
 * High-resolution real-time graphic audio spectrum analyzer JS module
 *
 * @author  Henrique Avila Vianna <hvianna@gmail.com> <https://henriquevianna.com>
 * @license AGPL-3.0-or-later
 */
class s{constructor(t,e={}){this._defaults={mode:0,fftSize:8192,minFreq:20,maxFreq:22e3,smoothing:.5,gradient:"classic",minDecibels:-85,maxDecibels:-25,showBgColor:!0,showLeds:!1,showScale:!0,showPeaks:!0,showFPS:!1,loRes:!1,width:640,height:270},this._gradients={classic:{bgColor:"#111",colorStops:["hsl( 0, 100%, 50% )",{pos:.6,color:"hsl( 60, 100%, 50% )"},"hsl( 120, 100%, 50% )"]},prism:{bgColor:"#111",colorStops:["hsl( 0, 100%, 50% )","hsl( 60, 100%, 50% )","hsl( 120, 100%, 50% )","hsl( 180, 100%, 50% )","hsl( 240, 100%, 50% )"]},rainbow:{bgColor:"#111",dir:"h",colorStops:["hsl( 0, 100%, 50% )","hsl( 60, 100%, 50% )","hsl( 120, 100%, 50% )","hsl( 180, 100%, 50% )","hsl( 240, 100%, 50% )","hsl( 300, 100%, 50% )","hsl( 360, 100%, 50% )"]}},this._container=t||document.body;var i=window.AudioContext||window.webkitAudioContext;try{this.audioCtx=new i}catch(t){throw"Could not create audio context. Web Audio API not supported?"}this.analyzer=this.audioCtx.createAnalyser(),this._audioSource=e.source?this.connectAudio(e.source):void 0,this.analyzer.connect(this.audioCtx.destination),this._defaults.width=this._container.clientWidth||this._defaults.width,this._defaults.height=this._container.clientHeight||this._defaults.height,this._mode=void 0===e.mode?this._defaults.mode:Number(e.mode),this._minFreq=void 0===e.minFreq?this._defaults.minFreq:e.minFreq,this._maxFreq=void 0===e.maxFreq?this._defaults.maxFreq:e.maxFreq,this.gradient=void 0===e.gradient?this._defaults.gradient:e.gradient,this.showBgColor=void 0===e.showBgColor?this._defaults.showBgColor:e.showBgColor,this.showLeds=void 0===e.showLeds?this._defaults.showLeds:e.showLeds,this.showScale=void 0===e.showScale?this._defaults.showScale:e.showScale,this.showPeaks=void 0===e.showPeaks?this._defaults.showPeaks:e.showPeaks,this.showFPS=void 0===e.showFPS?this._defaults.showFPS:e.showFPS,this._loRes=void 0===e.loRes?this._defaults.loRes:e.loRes,this._width=e.width,this._height=e.height,this.analyzer.fftSize=void 0===e.fftSize?this._defaults.fftSize:e.fftSize,this.analyzer.smoothingTimeConstant=void 0===e.smoothing?this._defaults.smoothing:e.smoothing,this.analyzer.minDecibels=void 0===e.minDecibels?this._defaults.minDecibels:e.minDecibels,this.analyzer.maxDecibels=void 0===e.maxDecibels?this._defaults.maxDecibels:e.maxDecibels,this._dataArray=new Uint8Array(this.analyzer.frequencyBinCount),this.onCanvasDraw="function"==typeof e.onCanvasDraw?e.onCanvasDraw:void 0,this.onCanvasResize="function"==typeof e.onCanvasResize?e.onCanvasResize:void 0,this.canvas=document.createElement("canvas"),this.canvas.style="max-width: 100%;",this._container.appendChild(this.canvas),this.canvasCtx=this.canvas.getContext("2d",{alpha:!1}),this._setCanvas("create"),window.addEventListener("resize",()=>{this._width&&this._height||this._setCanvas("resize")}),this.canvas.addEventListener("fullscreenchange",()=>this._setCanvas("fschange")),!1!==e.start&&this.toggleAnalyzer(!0)}get fftSize(){return this.analyzer.fftSize}set fftSize(t){this.analyzer.fftSize=t,this._dataArray=new Uint8Array(this.analyzer.frequencyBinCount),this._precalculateBarPositions()}get height(){return this._height}set height(t){this._height=t,this._setCanvas("user")}get width(){return this._width}set width(t){this._width=t,this._setCanvas("user")}get mode(){return this._mode}set mode(t){this._mode=Number(t),this._precalculateBarPositions()}get loRes(){return this._loRes}set loRes(t){this._loRes=Boolean(t),this._setCanvas("lores")}get minFreq(){return this._minFreq}set minFreq(t){this._minFreq=t,this._precalculateBarPositions()}get maxFreq(){return this._maxFreq}set maxFreq(t){this._maxFreq=t,this._precalculateBarPositions()}get minDecibels(){return this.analyzer.minDecibels}set minDecibels(t){this.analyzer.minDecibels=t}get maxDecibels(){return this.analyzer.maxDecibels}set maxDecibels(t){this.analyzer.maxDecibels=t}get smoothing(){return this.analyzer.smoothingTimeConstant}set smoothing(t){this.analyzer.smoothingTimeConstant=t}get audioSource(){return this._audioSource}get dataArray(){return this._dataArray}get fsWidth(){return this._fsWidth}get fsHeight(){return this._fsHeight}get fps(){return this._fps}get isFullscreen(){return document.fullscreenElement?document.fullscreenElement===this.canvas:document.webkitFullscreenElement?document.webkitFullscreenElement===this.canvas:void 0}get isOn(){return void 0!==this._animationReq}get pixelRatio(){return this._pixelRatio}connectAudio(t){var e=this.audioCtx.createMediaElementSource(t);return e.connect(this.analyzer),e}registerGradient(t,e){if("object"!=typeof e)throw"Custom gradient options must be an object";if(void 0===e.colorStops||e.colorStops.length<2)throw"Custom gradient must define at least two colors!";this._gradients[t]={},void 0!==e.bgColor?this._gradients[t].bgColor=e.bgColor:this._gradients[t].bgColor="#111",void 0!==e.dir&&(this._gradients[t].dir=e.dir),this._gradients[t].colorStops=e.colorStops,this._generateGradients()}setCanvasSize(t,e){this._width=t,this._height=e,this._setCanvas("user")}setFreqRange(t,e){this._minFreq=Math.min(t,e),this._maxFreq=Math.max(t,e),this._precalculateBarPositions()}setOptions(t){void 0!==t.mode&&(this._mode=Number(t.mode)),void 0!==t.minFreq&&(this._minFreq=t.minFreq),void 0!==t.maxFreq&&(this._maxFreq=t.maxFreq),void 0!==t.gradient&&(this.gradient=t.gradient),void 0!==t.showBgColor&&(this.showBgColor=t.showBgColor),void 0!==t.showLeds&&(this.showLeds=t.showLeds),void 0!==t.showScale&&(this.showScale=t.showScale),void 0!==t.minDecibels&&(this.analyzer.minDecibels=t.minDecibels),void 0!==t.maxDecibels&&(this.analyzer.maxDecibels=t.maxDecibels),void 0!==t.showPeaks&&(this.showPeaks=t.showPeaks),void 0!==t.showFPS&&(this.showFPS=t.showFPS),void 0!==t.loRes&&(this._loRes=t.loRes),void 0!==t.fftSize&&(this.analyzer.fftSize=t.fftSize),void 0!==t.smoothing&&(this.analyzer.smoothingTimeConstant=t.smoothing),"function"==typeof t.onCanvasDraw&&(this.onCanvasDraw=t.onCanvasDraw),"function"==typeof t.onCanvasResize&&(this.onCanvasResize=t.onCanvasResize),void 0!==t.width&&(this._width=t.width),void 0!==t.height&&(this._height=t.height),this._dataArray=new Uint8Array(this.analyzer.frequencyBinCount),this._setCanvas("user"),void 0!==t.start&&this.toggleAnalyzer(t.start)}setSensitivity(t,e){this.analyzer.minDecibels=Math.min(t,e),this.analyzer.maxDecibels=Math.max(t,e)}toggleAnalyzer(t){var e=this.isOn;return void 0===t&&(t=!e),e&&!t?(cancelAnimationFrame(this._animationReq),this._animationReq=void 0):!e&&t&&(this.frame=this._fps=0,this.time=performance.now(),this._animationReq=requestAnimationFrame(()=>this._draw())),this.isOn}toggleFullscreen(){this.isFullscreen?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():this.canvas.requestFullscreen?this.canvas.requestFullscreen():this.canvas.webkitRequestFullscreen&&this.canvas.webkitRequestFullscreen()}_draw(){var t,e,i,s,a,n,h=this.showLeds&&this._mode>0;for(this.showBgColor?this.canvasCtx.fillStyle=h?"#111":this._gradients[this.gradient].bgColor:this.canvasCtx.fillStyle="#000",this.canvasCtx.fillRect(0,0,this.canvas.width,this.canvas.height),this.analyzer.getByteFrequencyData(this._dataArray),i=this._analyzerBars.length,t=0;t<i;t++){if(0==(s=this._analyzerBars[t]).endIdx)a=this._dataArray[s.dataIdx];else if(a=0,s.average){for(e=s.dataIdx;e<=s.endIdx;e++)a+=this._dataArray[e];a/=s.endIdx-s.dataIdx+1}else for(e=s.dataIdx;e<=s.endIdx;e++)a=Math.max(a,this._dataArray[e]);(a=h?(a/255*this._ledOptions.nLeds|0)*(this._ledOptions.ledHeight+this._ledOptions.spaceV):a/255*this.canvas.height|0)>=s.peak&&(s.peak=a,s.hold=30,s.accel=0),this.canvasCtx.fillStyle=this._gradients[this.gradient].gradient,h?this.canvasCtx.fillRect(s.posX+this._ledOptions.spaceH/2,this.canvas.height,this._barWidth,-a):this.canvasCtx.fillRect(s.posX,this.canvas.height,this._barWidth,-a),s.peak>0&&(this.showPeaks&&(h?this.canvasCtx.fillRect(s.posX+this._ledOptions.spaceH/2,(this._ledOptions.nLeds-(s.peak/this.canvas.height*this._ledOptions.nLeds|0))*(this._ledOptions.ledHeight+this._ledOptions.spaceV),this._barWidth,this._ledOptions.ledHeight):this.canvasCtx.fillRect(s.posX,this.canvas.height-s.peak,this._barWidth,2)),s.hold?s.hold--:(s.accel++,s.peak-=s.accel))}h&&this.canvasCtx.drawImage(this._ledsMask,0,0),this.showScale&&(n=5*this._pixelRatio,this.isFullscreen&&(n*=2),this.canvasCtx.fillStyle="#000c",this.canvasCtx.fillRect(0,this.canvas.height-4*n,this.canvas.width,4*n),this.canvasCtx.fillStyle="#fff",this.canvasCtx.font=2*n+"px sans-serif",this.canvasCtx.textAlign="center",this._freqLabels.forEach(t=>this.canvasCtx.fillText(t.freq,t.posX,this.canvas.height-n))),this.frame++;var o=performance.now(),r=o-this.time;r>=1e3&&(this._fps=this.frame/(r/1e3),this.frame=0,this.time=o),this.showFPS&&(n=20*this._pixelRatio,this.canvasCtx.font=`bold ${n}px sans-serif`,this.canvasCtx.fillStyle="#0f0",this.canvasCtx.textAlign="right",this.canvasCtx.fillText(Math.round(this._fps),this.canvas.width-n,2*n)),this.onCanvasDraw&&this.onCanvasDraw(this),this._animationReq=requestAnimationFrame(()=>this._draw())}_generateGradients(){var t;Object.keys(this._gradients).forEach(e=>{t=this._gradients[e].dir&&"h"==this._gradients[e].dir?this.canvasCtx.createLinearGradient(0,0,this.canvas.width,0):this.canvasCtx.createLinearGradient(0,0,0,this.canvas.height),this._gradients[e].colorStops&&this._gradients[e].colorStops.forEach((i,s)=>{"object"==typeof i?t.addColorStop(i.pos,i.color):t.addColorStop(s/(this._gradients[e].colorStops.length-1),i)}),this._gradients[e].gradient=t})}_precalculateBarPositions(){var t,e,i=Math.log10(this._minFreq),s=this.canvas.width/(Math.log10(this._maxFreq)-i);if(this._analyzerBars=[],0==this._mode){this._barWidth=1;var a,n=-1,h=Math.floor(this._minFreq*this.analyzer.fftSize/this.audioCtx.sampleRate),o=Math.min(Math.round(this._maxFreq*this.analyzer.fftSize/this.audioCtx.sampleRate),this.analyzer.frequencyBinCount-1);for(t=h;t<=o;t++)e=t*this.audioCtx.sampleRate/this.analyzer.fftSize,(a=Math.round(s*(Math.log10(e)-i)))>n?(this._analyzerBars.push({posX:a,dataIdx:t,endIdx:0,average:!1,peak:0,hold:0,accel:0}),n=a):this._analyzerBars.length&&(this._analyzerBars[this._analyzerBars.length-1].endIdx=t)}else{var r=Math.min(6,this.canvas.height/(90*this._pixelRatio)|0),l=this._mode;switch(this._mode){case 8:l=24,r=Math.min(16,this.canvas.height/(33*this._pixelRatio)|0),this._ledOptions={nLeds:24,spaceH:Math.min(24,this.canvas.width/(40*this._pixelRatio)|0)};break;case 7:l=12,r=Math.min(8,this.canvas.height/(67*this._pixelRatio)|0),this._ledOptions={nLeds:48,spaceH:Math.min(16,this.canvas.width/(60*this._pixelRatio)|0)};break;case 6:l=8,this._ledOptions={nLeds:64,spaceH:Math.min(10,this.canvas.width/(96*this._pixelRatio)|0)};break;case 5:l=6;case 4:this._ledOptions={nLeds:80,spaceH:Math.min(8,this.canvas.width/(120*this._pixelRatio)|0)};break;case 3:this._ledOptions={nLeds:96,spaceH:Math.min(6,this.canvas.width/(160*this._pixelRatio)|0)};break;case 2:r=Math.min(4,this.canvas.height/(135*this._pixelRatio)|0),this._ledOptions={nLeds:128,spaceH:Math.min(4,this.canvas.width/(240*this._pixelRatio)|0)};break;default:this._mode=l=1,r=Math.min(3,Math.max(2,this.canvas.height/(180*this._pixelRatio)|0)),this._ledOptions={nLeds:128,spaceH:Math.min(4,this.canvas.width/(320*this._pixelRatio)|0)}}this._ledOptions.spaceH*=this._pixelRatio,this._ledOptions.spaceV=r*this._pixelRatio,this._ledOptions.nLeds=Math.min(this._ledOptions.nLeds,this.canvas.height/(2*this._ledOptions.spaceV)|0),this._ledOptions.ledHeight=this.canvas.height/this._ledOptions.nLeds-this._ledOptions.spaceV;var d=[],c=0;for(t=0;(e=16.351597831287403*(2**(1/24))**t)<=this._maxFreq;)e>=this._minFreq&&t%l==0&&d.push(e),t++;this._barWidth=Math.floor(this.canvas.width/d.length)-1;var u=(this.canvas.width-this._barWidth*d.length)/(d.length-1);this._ledsMask.width|=0,d.forEach((t,e)=>{var i,s,a=Math.round(t*this.analyzer.fftSize/this.audioCtx.sampleRate),n=!1;i=c>0&&c+1<=a?c+1:a,c=s=a,void 0!==d[e+1]&&((s=Math.round(d[e+1]*this.analyzer.fftSize/this.audioCtx.sampleRate))-a>1?c+=Math.round((s-a)/2):s-a==1&&this._analyzerBars.length>0&&i==this._analyzerBars[this._analyzerBars.length-1].dataIdx&&(n=!0,c+=Math.round((s-a)/2))),this._analyzerBars.push({posX:e*(this._barWidth+u),dataIdx:i,endIdx:c-i>0?c:0,average:n,peak:0,hold:0,accel:0}),this._ledsCtx.fillRect(this._analyzerBars[this._analyzerBars.length-1].posX-this._ledOptions.spaceH/2,0,this._ledOptions.spaceH,this.canvas.height)})}if(this._mode>0)for(this._ledsCtx.fillRect(this._analyzerBars[this._analyzerBars.length-1].posX+this._barWidth-this._ledOptions.spaceH/2+(this._mode<5?2:1),0,this._ledOptions.spaceH,this.canvas.height),t=this._ledOptions.ledHeight;t<this.canvas.height;t+=this._ledOptions.ledHeight+this._ledOptions.spaceV)this._ledsCtx.fillRect(0,t,this.canvas.width,this._ledOptions.spaceV);this._freqLabels=[{freq:16},{freq:31},{freq:63},{freq:125},{freq:250},{freq:500},{freq:1e3},{freq:2e3},{freq:4e3},{freq:8e3},{freq:16e3}],this._freqLabels.forEach(t=>{t.posX=s*(Math.log10(t.freq)-i),t.freq>=1e3&&(t.freq=t.freq/1e3+"k")})}_setCanvas(t){this._pixelRatio=window.devicePixelRatio,this._loRes&&(this._pixelRatio/=2),this._fsWidth=Math.max(window.screen.width,window.screen.height)*this._pixelRatio,this._fsHeight=Math.min(window.screen.height,window.screen.width)*this._pixelRatio,this.isFullscreen?(this.canvas.width=this._fsWidth,this.canvas.height=this._fsHeight):(this.canvas.width=(this._width||this._container.clientWidth||this._defaults.width)*this._pixelRatio,this.canvas.height=(this._height||this._container.clientHeight||this._defaults.height)*this._pixelRatio),2==this._pixelRatio&&window.screen.height<=540&&(this._pixelRatio=1),this.canvasCtx.fillStyle="#000",this.canvasCtx.fillRect(0,0,this.canvas.width,this.canvas.height),this._generateGradients(),this._ledsMask=this.canvas.cloneNode(),this._ledsCtx=this._ledsMask.getContext("2d"),this._ledsCtx.fillStyle="#000",this._precalculateBarPositions(),this.onCanvasResize&&this.onCanvasResize(t,this)}}},function(t,e,i){"use strict";i.r(e);var s=i(0),a=document.getElementById("audio"),n=!0;try{var h=new s.a(document.getElementById("container"),{source:a,showFPS:!0,onCanvasDraw:function(){if(!n)return;var t=20*h.pixelRatio;h.isFullscreen&&(t*=2);h.canvasCtx.font=`${t}px Orbitron,sans-serif`;var e=h.canvasCtx.measureText("audioMotion").width/2;h.canvasCtx.font=`${t+h.dataArray[1]/16*h.pixelRatio}px Orbitron,sans-serif`,h.canvasCtx.fillStyle="#fff8",h.canvasCtx.textAlign="center",h.canvasCtx.fillText("audioMotion",h.canvas.width-e-4*t,2*t)},onCanvasResize:function(t,e){console.log(`[${t}] set: ${e.width} x ${e.height} | actual: ${e.canvas.width} x ${e.canvas.height}`)}})}catch(t){document.getElementById("container").innerHTML=`<p>audioMotion-analyzer failed with error: <em>${t}</em></p>`}!function(){switch(document.getElementById("fft").value=h.fftSize,document.getElementById("mode").value=h.mode,document.getElementById("gradient").value=h.gradient,document.getElementById("smoothing").value=h.smoothing,h.minFreq){case 20:document.getElementById("range").selectedIndex=1;break;case 30:document.getElementById("range").selectedIndex=2;break;case 100:document.getElementById("range").selectedIndex=3}switch(h.maxDecibels){case-10:document.getElementById("sensitivity").value=0;break;case-20:document.getElementById("sensitivity").value=1;break;case-25:document.getElementById("sensitivity").value=2;break;case-30:document.getElementById("sensitivity").value=3;break;case-40:document.getElementById("sensitivity").value=4}}();var o=h.audioCtx,r=o.createOscillator(),l=o.createGain();r.frequency.setValueAtTime(0,o.currentTime),r.connect(l),r.start(),l.connect(h.analyzer),document.getElementById("btn_fullscr").addEventListener("click",()=>h.toggleFullscreen()),document.getElementById("btn_bgcolor").addEventListener("click",()=>h.showBgColor=!h.showBgColor),document.getElementById("btn_peaks").addEventListener("click",()=>h.showPeaks=!h.showPeaks),document.getElementById("btn_leds").addEventListener("click",()=>h.showLeds=!h.showLeds),document.getElementById("btn_scale").addEventListener("click",()=>h.showScale=!h.showScale),document.getElementById("btn_lores").addEventListener("click",()=>h.loRes=!h.loRes),document.getElementById("btn_fps").addEventListener("click",()=>h.showFPS=!h.showFPS),document.getElementById("btn_logo").addEventListener("click",()=>n=!n),document.getElementById("btn_freeze").addEventListener("click",()=>h.toggleAnalyzer()),document.getElementById("fft").addEventListener("change",t=>h.fftSize=t.target.value),document.getElementById("mode").addEventListener("change",t=>h.mode=t.target.value),document.getElementById("gradient").addEventListener("change",t=>h.gradient=t.target.value),document.getElementById("range").addEventListener("change",t=>{let e=t.target[t.target.selectedIndex];h.setFreqRange(e.dataset.min,e.dataset.max)}),document.getElementById("smoothing").addEventListener("change",t=>h.smoothing=t.target.value),document.getElementById("sensitivity").addEventListener("change",t=>{switch(t.target.value){case"0":h.setSensitivity(-70,-10);break;case"1":h.setSensitivity(-80,-20);break;case"2":h.setSensitivity(-85,-25);break;case"3":h.setSensitivity(-90,-30);break;case"4":h.setSensitivity(-100,-40)}}),document.querySelectorAll(".tones").forEach(t=>t.addEventListener("click",t=>{r.type=t.target.dataset.wave,r.frequency.setValueAtTime(t.target.dataset.freq,o.currentTime),l.gain.setValueAtTime(.2,o.currentTime)})),document.getElementById("btn_soundoff").addEventListener("click",()=>l.gain.setValueAtTime(0,o.currentTime)),document.getElementById("uploadFile").addEventListener("change",t=>(function(t){var e=new FileReader;e.readAsDataURL(t.files[0]),e.onload=()=>{a.src=e.result,a.play()}})(t.target)),document.getElementById("loadFromURL").addEventListener("click",()=>{a.src=document.getElementById("remoteURL").value,a.play()}),window.addEventListener("click",()=>{"suspended"==h.audioCtx.state&&h.audioCtx.resume()})}]);